{
    "contents" : "## Code to convert exported FM file to find failure reasons.\n# Needs to grab just failures\n# sort via reason\n# calculate percent of each reason\nlibrary(dplyr)\nlibrary(xlsx)\nlibrary(stringr)\nfilename <- readline(\"What is the file called? Don't forget the extension... \")\n\noutputname <- readline(\"What is the output file called?...  \")\noutputname <- paste(outputname, \".xlsx\", sep=\"\")\n\nrawdata <- read.table(filename, \n                      sep=\"\\t\", \n                      stringsAsFactors=FALSE, \n                      na.strings = \"\",\n                      quote=\"\")\n\ncolnames(rawdata) <- c(\"Failure_Reason\", \n                       \"Five_Prime_mod\", \n                       \"Three_Prime_mod\", \n                       \"sequence\")\n#converts to tbl_df to enable advanced data manipulation\nraw_tbl_df <- tbl_df(rawdata)\n\n#converts all characters to lower case to enable easy manipulation\nraw_tbl_df$Failure_Reason <- tolower(raw_tbl_df$Failure_Reason)\n#Removes double spaces to enable easy manipulation\nraw_tbl_df$Failure_Reason <- gsub(\"  \", \" \", raw_tbl_df$Failure_Reason)\n#turns all see SS number for syn info notes into NA to enable removal\nraw_tbl_df$Failure_Reason <- gsub(\"see\", NA, raw_tbl_df$Failure_Reason)\n#turns all good wobbles into NA to enable removal\n\n###raw_tbl_df$Failure_Reason <- gsub(\"wobble okay\", NA, raw_tbl_df$Failure_Reason)\n\n#turns all reassign notes to NA's to enable removal\nraw_tbl_df$Failure_Reason <- gsub(\"reassign\", NA, raw_tbl_df$Failure_Reason)\n\n#turns all material notes to NA's to enable removal\nraw_tbl_df$Failure_Reason <- gsub(\"material\", NA, raw_tbl_df$Failure_Reason)\n\n#turns all collection plates notes to NA's to enable removal\nraw_tbl_df$Failure_Reason <- gsub(\"collection\", NA, raw_tbl_df$Failure_Reason)\n\n#removes Na values: passed, wobble, reassign, material, etc\nfailures <- filter(raw_tbl_df, !is.na(Failure_Reason))\n\n#removes blank space at beginning or end of failure reason.\nfailures$Failure_Reason <- str_trim(failures$Failure_Reason)\n\n#rename ms not okay notes to be the same\nfailures$Failure_Reason <- gsub(\"ms n\", NA, failures$Failure_Reason)\nfailures$Failure_Reason[is.na(failures[,1])] <- \"ms NOT okay\"\n\n#rename ms okay notes to be the same\nfailures$Failure_Reason <- gsub(\"ms o\", NA, failures$Failure_Reason)\nfailures$Failure_Reason[is.na(failures[,1])] <- \"ms okay\"\n\n#rename un checked Low yield notes to be all the same\nfailures$Failure_Reason <- gsub(\"low y\", NA, failures$Failure_Reason)\nfailures$Failure_Reason[is.na(failures[,1])] <- \"low yield\"\n\n#rename all wrong mass to be the same\n\nsorted <- arrange(failures, Failure_Reason, Three_Prime_mod, Five_Prime_mod)\n\nby_Reason <- group_by(sorted, Failure_Reason)\nreason_counts <- summarize(by_Reason, number_of_failures = n())\nclass(reason_counts) <- \"data.frame\"\nclass(sorted) <- \"data.frame\"\n\nby_reason_mods <- group_by(sorted, Failure_Reason, Five_Prime_mod, Three_Prime_mod)\nreason_mod_counts <- summarize(by_reason_mods, failure_per_mod = n())\n\nreason_count_arranged <- arrange(reason_counts, desc(number_of_failures))\n\ndate <- Sys.Date()\n\n\ncountedname <- paste(\"Counted\", \"for\", date, sep=\" \")\nrawname <- paste(\"Raw\", \"for\", date, sep=\" \")\n\nwrite.xlsx(reason_count_arranged,\n           file=outputname, \n           sheetName=countedname,\n           row.names=FALSE,\n           append=FALSE)\n\nwrite.xlsx(sorted, \n           outputname,\n           sheetName=rawname,\n           row.names=FALSE,\n           append=TRUE)\n\n\n\n\n",
    "created" : 1425067356263.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "301106844",
    "id" : "8A3B0538",
    "lastKnownWriteTime" : 1425008613,
    "path" : "C:/Users/cferguson/Desktop/biosearch_projects/failurelist.R",
    "project_path" : "failurelist.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}